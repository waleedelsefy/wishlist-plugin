jQuery(function(_){_.fn.dependency=function(t,e,n,c){var o=_(this);o.on("change",function(){var i=e(o);_.each(t,function(t,e){var n,e=_(e);!e.length||(n=e.closest("tr")).length&&(i?n.show().fadeTo("slow",1):n.is(":visible")?n.fadeTo("slow",0,function(){n.hide()}):n.css("opacity",0).hide())}),void 0!==n&&n(o,c)}).change()};var n=function(e,t){var c=this;c.settings={},c.modal=null,c._init=function(){c.settings=_.extend({template:e.data("template"),template_data:{},container:".aj-wcwl-wizard-modal",events:{}},t),"function"==typeof c.settings.events.init&&c.settings.events.init(e,t),c._initOpener()},c._initOpener=function(){e.on("click",function(t){var e=_(this),n=c.settings.template_data;t.preventDefault(),"function"==typeof n&&(n=n(e)),e.WCBackboneModal({template:c.settings.template,variable:n});e=_(c.settings.container);c._initEditor(e),c._initEnhancedSelect(e),c._initTabs(e),c._initSteps(e),c._initOptions(e,n),c._initEvents(e,c.settings.events)})},c._initEditor=function(t){t.find(".with-editor").each(function(){var n=_(this),t=n.attr("id");tinymce.get(t)&&(restoreTextMode=tinymce.get(t).isHidden(),wp.editor.remove(t)),wp.editor.initialize(t,{tinymce:{wpautop:!0,init_instance_callback:function(e){e.on("Change",function(t){n.val(e.getContent()).change()})}},quicktags:!0,mediaButtons:!0})})},c._initEnhancedSelect=function(t){_(document.body).trigger("wc-enhanced-select-init")},c._initTabs=function(t){t.find(".tabs").on("click","a",function(t){var e=_(this),n=e.closest("ul"),i=n.find("a"),c=n.parent().find(".tab"),o=e.data("target"),n=_(o),o=!1;t.preventDefault(),e.hasClass("active")||(o=!0),i.attr("aria-selected","false").removeClass("active"),e.attr("aria-selected","true").addClass("active"),c.attr("aria-expanded","false").removeClass("active").hide(),n.attr("aria-expanded","true").addClass("active").show(),o&&e.trigger("tabChange")})},c._initOptions=function(n,t){_.each(t,function(t,e){t=n.find('[name="'+t+'"]');t.length&&e!==t.val()&&(t.is("select")&&!t.find('option[value="'+e+'"]').length?t.append('<option value="'+e+'" selected="selected">'+e+" </option>"):t.val(e))})},c._initSteps=function(i){i.find(".step").hide().first().show(),i.find(".continue-button").on("click",function(t){var e=_(this).closest(".step"),n=e.next(".step");t.preventDefault(),n.length&&c._changeStep(i,e,n)}),i.find(".back-button").on("click",function(t){var e=_(this).closest(".step"),n=e.prev(".step");t.preventDefault(),n.length&&c._changeStep(i,e,n)})},c._initEvents=function(n,t){"function"==typeof c.settings.events.open&&c.settings.events.open(e,n),_.each(t,function(t,e){"init"!==t&&"open"!==t&&("tabChange"===t?n.find(".tabs"):"stepChange"===t?n.find(".step"):n.find(":input")).on(t,function(t){return e(_(this),n,t)})})},c._changeStep=function(o,_,a){_.animate({opacity:0},{duration:200,complete:function(){var t=o.find("article"),e=t.outerWidth(),n=t.outerHeight();t.outerWidth("auto"),t.outerHeight("auto"),_.hide(),a.show();var i=a.outerWidth(),c=a.outerHeight();a.hide(),_.css("opacity",1),t.outerWidth(e),t.outerHeight(n),t.animate({width:i,height:c},{duration:200,complete:function(){a.fadeIn(200)}})}}),a.trigger("stepChange")},c._init()},o=null,i=function(t,e,n){var i=e.find(".email-preview"),c=e.find("#template").val();o&&o.abort(),o=_.ajax({url:ajaxurl+"?action=preview_promotion_email",data:e.find("form").serialize(),method:"POST",beforeSend:function(){i.block({message:null,overlayCSS:{background:"transparent",opacity:.6}})},complete:function(){i.unblock()},success:function(t){i.removeClass("html plain").addClass(c).find(".no-interactions").html(t)}})},t=function(){return{template:"aj-wcwl-promotion-wizard",template_data:function(t){var e=t.hasClass("restore-draft")?t.data("draft"):_.extend(e,{product_id:t.data("product_id"),user_id:t.data("user_id")});return e},events:{change:i,open:function(t,e,n){e.find("#content_html-tmce").click(),i(0,e)},tabChange:function(t,e,n){e.find("#template").val(t.find(".active").data("template")),i(0,e)},stepChange:function(t,e,n){var i=t.find(".receivers-count"),c=t.find(".show-on-long-queue"),o=c.data("threshold");i.length&&_.ajax({url:ajaxurl+"?action=calculate_promotion_email_receivers",data:e.find("form").serialize(),method:"post",beforeSend:function(){i.css("opacity",.3),c.length&&c.hide()},complete:function(){i.css("opacity",1)},success:function(t){"undefined"!=typeof t.label&&(i.html(t.label),c.length&&"undefined"!=typeof t.count&&t.count>o&&c.show())}})}}}};_.fn.wizard=function(t){var e=_(this);new n(e,t)},_(".create-promotion").wizard(t()),_(".restore-draft").wizard(t());var e=function(t){return"no"===(t=!t.is('input[type="radio"]')?t.find('input[type="radio"]:checked'):t).val()},c=function(t){return t.is(":checked")},a=_("#aj_wcwl_disable_wishlist_for_unauthenticated_users"),s=_("#aj_wcwl_multi_wishlist_enable"),l=_("#aj_wcwl_enable_multi_wishlist_for_unauthenticated_users"),r=_("#aj_wcwl_modal_enable"),u=_("#aj_wcwl_loop_position"),h=_(".icon-select"),d=_('[name="aj_wcwl_add_to_cart_style"]'),w=_("#aj_wcwl_add_to_cart_icon"),m=_('[name="aj_wcwl_ask_an_estimate_style"]'),f=_("#aj_wcwl_ask_an_estimate_icon"),p=_("#aj_wcwl_enable_share"),y=_("#aj_wcwl_share_fb"),g=_("#aj_wcwl_fb_button_icon"),v=_("#aj_wcwl_share_twitter"),b=_("#aj_wcwl_tw_button_icon"),k=_("#aj_wcwl_share_pinterest"),x=_("#aj_wcwl_pr_button_icon"),C=_("#aj_wcwl_share_email"),S=_("#aj_wcwl_em_button_icon"),T=_("#aj_wcwl_share_whatsapp"),z=_("#aj_wcwl_wa_button_icon"),j=_("#aj_wcwl_show_estimate_button"),E=_("#aj_wcwl_show_additional_info_textarea"),H=_("#aj_wcwl_ask_an_estimate_fields"),O=_("#woocommerce_promotion_mail_settings\\[email_type\\]"),W=_("#woocommerce_aj_wcwl_back_in_stock_settings\\[enabled\\]"),D=_("#woocommerce_aj_wcwl_back_in_stock_settings\\[email_type\\]"),q=_("#woocommerce_aj_wcwl_on_sale_item_settings\\[enabled\\]"),B=_("#woocommerce_aj_wcwl_on_sale_item_settings\\[email_type\\]"),t=_('[id^="type_"]');u.add("select#aj_wcwl_button_position").on("change",function(){var t=_(this);"shortcode"===t.val()?t.parent().next().find(".addon").show():t.parent().next().find(".addon").hide()}).change(),t.on("change",function(){var t=_(this),e=t.val(),n=t.closest(".aj-toggle-content-row").next();"radio"===e||"select"===e?n.show().fadeTo("slow",1):n.is(":visible")?n.fadeTo("slow",0,function(){n.hide()}):n.css("opacity",0).hide()}).change(),d.on("change",function(){w.change()}),m.on("change",function(){f.change()}),h.each(function(){_(this).select2({templateResult:function(t){return t.id?_('<span><i class="option-icon fa '+t.element.value.toLowerCase()+'" ></i> '+t.text+"</span>"):t.text}})}),a.dependency(["#aj_wcwl_enable_multi_wishlist_for_unauthenticated_users-yes"],function(){return e(a)&&c(s)},function(){l.change()}),s.dependency(["#aj_wcwl_enable_multi_wishlist_for_unauthenticated_users-yes"],function(){return e(a)&&c(s)},function(){l.change()}),l.dependency(["#aj_wcwl_show_login_notice","#aj_wcwl_login_anchor_text"],function(){return c(s)&&e(a)&&e(l)}),r.dependency(["#aj_wcwl_show_exists_in_a_wishlist"],function(){var t="default"!==r.find(":checked").val();return t||_("#aj_wcwl_show_exists_in_a_wishlist").prop("checked",!0),t}),w.dependency(["#aj_wcwl_add_to_cart_custom_icon"],function(){return"custom"===w.val()&&"button_custom"===d.filter(":checked").val()}),f.dependency(["#aj_wcwl_ask_an_estimate_custom_icon"],function(){return"custom"===f.val()&&"button_custom"===m.filter(":checked").val()}),p.dependency(["#aj_wcwl_share_fb"],c,function(){y.change(),g.change(),v.change(),b.change(),k.change(),x.change(),C.change(),S.change(),T.change(),z.change()}),y.dependency(["#aj_wcwl_fb_button_icon","#aj_wcwl_color_fb_button_background"],function(){return c(y)&&c(p)},function(){g.change()}),g.dependency(["#aj_wcwl_fb_button_custom_icon"],function(){return c(y)&&c(p)&&"custom"===g.val()}),v.dependency(["#aj_wcwl_tw_button_icon","#aj_wcwl_color_tw_button_background"],function(){return c(v)&&c(p)},function(){b.change()}),b.dependency(["#aj_wcwl_tw_button_custom_icon"],function(){return c(v)&&c(p)&&"custom"===b.val()}),k.dependency(["#aj_wcwl_socials_image_url","#aj_wcwl_pr_button_icon","#aj_wcwl_color_pr_button_background"],function(){return c(k)&&c(p)},function(){x.change()}),x.dependency(["#aj_wcwl_pr_button_custom_icon"],function(){return c(k)&&c(p)&&"custom"===x.val()}),C.dependency(["#aj_wcwl_em_button_icon","#aj_wcwl_color_em_button_background"],function(){return c(C)&&c(p)},function(){S.change()}),S.dependency(["#aj_wcwl_em_button_custom_icon"],function(){return c(C)&&c(p)&&"custom"===S.val()}),T.dependency(["#aj_wcwl_wa_button_icon","#aj_wcwl_wa_button_custom_icon","#aj_wcwl_color_wa_button_background"],function(){return c(T)&&c(p)},function(){z.change()}),z.dependency(["#aj_wcwl_wa_button_custom_icon"],function(){return c(T)&&c(p)&&"custom"===z.val()}),v.add(k).dependency(["#aj_wcwl_socials_title","#aj_wcwl_socials_text"],function(){return(c(v)||c(k))&&c(p)}),j.dependency(["#aj_wcwl_show_additional_info_textarea"],c,function(){E.change()}),j.on("change",function(){E.change()}),E.dependency(["#aj_wcwl_additional_info_textarea_label"],function(){return c(j)&&c(E)}),E.on("change",function(){_(this).is(":checked")&&j.is(":checked")?H.removeClass("aj-disabled"):H.addClass("aj-disabled")}),O.dependency(["#woocommerce_promotion_mail_settings\\[content_html\\]"],function(){return"multipart"===O.val()||"html"===O.val()}),O.dependency(["#woocommerce_promotion_mail_settings\\[content_text\\]"],function(){return"multipart"===O.val()||"plain"===O.val()}),W.dependency(["#woocommerce_aj_wcwl_back_in_stock_settings\\[product_exclusions\\]","#woocommerce_aj_wcwl_back_in_stock_settings\\[category_exclusions\\]","#woocommerce_aj_wcwl_back_in_stock_settings\\[email_type\\]","#woocommerce_aj_wcwl_back_in_stock_settings\\[heading\\]","#woocommerce_aj_wcwl_back_in_stock_settings\\[subject\\]","#woocommerce_aj_wcwl_back_in_stock_settings\\[content_html\\]","#woocommerce_aj_wcwl_back_in_stock_settings\\[content_text\\]"],function(){return c(W)},function(){D.change()}),D.dependency(["#woocommerce_aj_wcwl_back_in_stock_settings\\[content_html\\]"],function(){return("multipart"===D.val()||"html"===D.val())&&c(W)}),D.dependency(["#woocommerce_aj_wcwl_back_in_stock_settings\\[content_text\\]"],function(){return("multipart"===D.val()||"plain"===D.val())&&c(W)}),q.dependency(["#woocommerce_aj_wcwl_on_sale_item_settings\\[product_exclusions\\]","#woocommerce_aj_wcwl_on_sale_item_settings\\[category_exclusions\\]","#woocommerce_aj_wcwl_on_sale_item_settings\\[email_type\\]","#woocommerce_aj_wcwl_on_sale_item_settings\\[heading\\]","#woocommerce_aj_wcwl_on_sale_item_settings\\[subject\\]","#woocommerce_aj_wcwl_on_sale_item_settings\\[content_html\\]","#woocommerce_aj_wcwl_on_sale_item_settings\\[content_text\\]"],function(){return c(q)},function(){B.change()}),B.dependency(["#woocommerce_aj_wcwl_on_sale_item_settings\\[content_html\\]"],function(){return("multipart"===B.val()||"html"===B.val())&&c(q)}),B.dependency(["#woocommerce_aj_wcwl_on_sale_item_settings\\[content_text\\]"],function(){return("multipart"===B.val()||"plain"===B.val())&&c(q)}),_(document).on("aj-add-box-button-toggle",function(){var e=_("#new_type"),n=_("#new_options").closest(".aj-add-box-row");e.on("change",function(){var t=e.val();"radio"===t||"select"===t?n.show().fadeTo("slow",1):n.is(":visible")?n.fadeTo("slow",0,function(){_(this).hide()}):n.css("opacity",0).hide()}).change()})});